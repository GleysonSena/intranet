$('#simulation-form').remove();
$('#aviso').remove();
$('#simulation').parent().append('<%= j render 'form' %>');
$('select').formSelect();
var scoreArrayCollection = $('#simulation').data('score-options');
var crlArrayCollection = $('#simulation').data('crl-options');
var garantiaArrayCollection = $('#simulation').data('garantia-options');
var iapArrayCollection = $('#simulation').data('iap-options');
setDiscoutValues();


$('select').change(function () {
     setDiscoutValues();
  });

function setDiscoutValues(){
    setScore(scoreArrayCollection);
    setCrl(crlArrayCollection);
    setIap(iapArrayCollection);
    setGarantia(garantiaArrayCollection);
    setGarantia2(garantiaArrayCollection);
    getTaxValue();
    setTotalDiscount();
};

function setScore(arrayCollections){
    var selectIndex = $('#score-info :selected').index();       
    $('#discount-score').text('');
    $('#discount-score').text(setCurrentTax(arrayCollections[selectIndex].real_value) + '%');
    
};

function setCrl(arrayCollections){
    var selectIndex = $('#clr-info :selected').index();       
    $('#discount-crl').text('');
    $('#discount-crl').text(setCurrentTax(arrayCollections[selectIndex].real_value) + '%');
};

function setIap(arrayCollections){
    var selectIndex = $('#iap-info :selected').index();       
    $('#discount-iap').text('');
    $('#discount-iap').text(setCurrentTax(arrayCollections[selectIndex].real_value) + '%');
};
function setGarantia(arrayCollections){
    var selectIndex = $('#garantia-info :selected').index();       
    $('#discount-garantia').text('');
    $('#discount-garantia').text(setCurrentTax(arrayCollections[selectIndex].real_value) + '%');
};
function setGarantia2(arrayCollections){
    var selectIndex = $('#garantia2-info :selected').index();       
    $('#discount-garantia2').text('');
    $('#discount-garantia2').text(setCurrentTax(arrayCollections[selectIndex].real_value) + '%');
};
function setGarantia3(arrayCollections){
    var selectIndex = $('#garantia3-info :selected').index();       
    $('#discount-garantia3').text('');
    $('#discount-garantia3').text(setCurrentTax(arrayCollections[selectIndex].real_value) + '%');
};

function updtadeTax(taxValue){
  $('#discount-tax').text('');
  $('#discount-tax').text(taxValue + '%');

};

function getTaxValue(){    
    var setScore =  parseFloat($('#discount-score').text());
    var setCrl = parseFloat($('#discount-crl').text());
    var setIap =  parseFloat($('#discount-iap').text());
    var setGarantia = parseFloat($('#discount-garantia').text());
    var setGarantia2 =  parseFloat($('#discount-garantia2').text());
    var setGarantia3 =  parseFloat($('#discount-garantia3').text());
    var maxPercent = parseFloat($('.max-percent').text());
    var taxValue = setScore + setCrl + setIap +  setGarantia + setGarantia2 ;
    updtadeTax((taxValue));
};

function setCurrentTax(tax){
    var minimunPercent = parseFloat($('.minimun-percent').text());
    var maxPercent = parseFloat($('.max-percent').text());
    var result = ((((maxPercent - minimunPercent) / 100 ) * tax ));   
    return result.toFixed(2);
};

function setTotalDiscount(){
     var maxPercent = parseFloat($('.max-percent').text());
     var discountTax = parseFloat($('#discount-tax').text());    
     $('#total-discount-tax h4').text(maxPercent - discountTax + '%');
};
